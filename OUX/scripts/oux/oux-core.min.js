"use strict";var moment=require("moment"),OUX,oux;(function(n){function i(n){return n===undefined?!0:n===null?!0:n===NaN?!0:n==={}?!0:n===[]?!0:String(n).trim().length===0?!0:!1}function t(n,t){return t===void 0&&(t=undefined),i(n)?t:n}function r(n,i,r){var u,f;return i===void 0&&(i=""),r===void 0&&(r=[]),u=angular.lowercase(String(n)).trim(),r.length>0&&(f=!1,angular.forEach(r,function(n){angular.lowercase(n).trim()===u&&(f=!0)}),f||(u=undefined)),t(u,angular.lowercase(i).trim())}var o,u,s,e,f,h,c,l,a;n.IsBlank=i;n.IfBlank=t;n.Option=r,function(n){var r=function(){function n(n){var t=this;this.$window=n;this.formatDate=function(n){var i=moment(String(n).trim().substr(0,10),"YYYY-MM-DD");if(i.isValid())return i.format(t.dateFormat.moment)};this.parseDate=function(n){var i=moment(String(n).trim(),t.dateFormat.moment);if(i.isValid())return i.format("YYYY-MM-DD")};this.formatNumber=function(n,r){if(r===void 0&&(r=2),i(n)||isNaN(Number(n)))return undefined;var u=String(Number(n).toFixed(r)).split(".",2);return u[0]=u[0].replace(/[^0-9-]/g,"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,").replace(/,/g,t.numberFormat.groupSeparator),u[1]&&(u[1]=u[1].replace(/[^0-9-]/g,"")),u.join(t.numberFormat.decimalSeparator)};this.parseNumber=function(n,r){if(r===void 0&&(r=2),i(n))return undefined;var u=String(n).split(t.numberFormat.decimalSeparator,2);return(u[0]=u[0].replace(new RegExp(t.numberFormat.groupSeparator,"g"),","),!/^((?:[+-])?(?:\d{1,3}(?:\,?\d{3})*))$/g.test(u[0]))?undefined:/[^0-9]/g.test(u[1])?undefined:(u[0]=u[0].replace(/,/g,""),Number(u.join(".")).toFixed(r))}}return Object.defineProperty(n.prototype,"localeId",{get:function(){return t(this.$window.localStorage.getItem("localeId"),"gb")},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dateFormat",{get:function(){switch(this.localeId){case"us":return{angular:"MM/dd/yyyy",moment:"MM/DD/YYYY"};default:return{angular:"dd/MM/yyyy",moment:"DD/MM/YYYY"}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"numberFormat",{get:function(){switch(this.localeId){case"eu":return{groupSeparator:" ",decimalSeparator:","};default:return{groupSeparator:",",decimalSeparator:"."}}},enumerable:!0,configurable:!0}),n.$inject=["$window"],n}();n.Service=r}(o=n.Locale||(n.Locale={})),function(n){var t=function(){function n(){}return Object.defineProperty(n,"viewFormat",{get:function(){return moment.localeData().longDateFormat("L")},enumerable:!0,configurable:!0}),Object.defineProperty(n,"modelFormat",{get:function(){return"YYYY-MM-DD"},enumerable:!0,configurable:!0}),n.Parser=function(t){var i=undefined;switch(r(t)){case"today":i=moment();break;case"yesterday":i=moment().subtract(1,"days");break;case"tomorrow":i=moment().add(1,"days");break;default:i=moment(t,n.viewFormat)}return i.isValid()?i.format(n.modelFormat):undefined},n.Formatter=function(t){var i=moment(String(t).substr(0,10),n.modelFormat);return i.isValid()?i.format(n.viewFormat):undefined},n}();n.Date=t}(u=n.Convert||(n.Convert={})),function(n){function f(){var n=function(){return{restrict:"E",scope:!1,controller:r,controllerAs:"oux"}};return n.$inject=["$log"],n}var r=function(){function n(n,r,f,e,o){var s=this;this.$scope=n;this.$routeParams=r;this.$parse=f;this.$window=e;this.$log=o;this.procedures={};this.addProcedure=function(n){s.procedures[n.alias]=n;s.$log.debug('OUX procedure "'+n.alias+'" added to context')};this.removeProcedure=function(n){delete s.procedures[n.alias];s.$log.debug('OUX procedure "'+n.alias+'" removed from context')};this.parameterValue=function(n){var r=undefined;switch(n.type){case"route":r=s.$routeParams[n.value];break;case"scope":r=s.$parse(n.value)(s.$scope);break;default:r=n.value}if(i(r))return null;switch(n.format){case"date":r=u.Date.Parser(u.Date.Formatter(r));break;case"object":r=angular.fromJson(angular.toJson(r));break;default:r=String(r)}return t(r,null)};this.execute=function(n){var i=s.procedures[n],r={token:t(s.$window.localStorage.getItem("token")),procedure:{name:i.name,parameters:[]}};angular.forEach(i.parameters,function(n){r.procedure.parameters.push({name:n.name,value:s.parameterValue(n),isObject:n.format==="object"})});s.$log.debug('OUX execute procedure "'+i.alias+'"');s.$log.debug(r)};o.debug('OUX context instantiated on page "'+e.location+'"')}return n.$inject=["$scope","$routeParams","$parse","$window","$log"],n}();n.Controller=r;n.DirectiveFactory=f}(s=n.Context||(n.Context={})),function(n){function u(){return{restrict:"E",scope:{name:"@",alias:"@",run:"@",routeParams:"@"},controller:i,require:["^^oux","ouxProcedure"],link:{pre:function(n,t,i,r){r[0].addProcedure(r[1]);n.$on("$destroy",function(){r[0].removeProcedure(r[1])})},post:function(n,t,i,r){r[1].run!=="manual"&&r[0].execute(r[1].alias);r[1].run==="auto"&&n.$watchCollection(function(){return r[1].parameters},function(n,t){n!==t&&r[0].execute(r[1].alias)})}}}}var i=function(){function n(n,t,i){var u=this;this.$scope=n;this.$log=i;this.parameters={};this.addParameter=function(n){u.parameters[n.name]=n;u.$log.debug('OUX parameter "'+n.name+'" added to procedure "'+u.alias+'"')};this.removeParameter=function(n){delete u.parameters[n.name];u.$log.debug('OUX parameter "'+n.name+'" removed from procedure "'+u.alias+'"')};r(n.routeParams)==="true"&&angular.forEach(t,function(t,i){u.addParameter(new f.Controller(angular.extend(n.$new(!0),{name:i,type:"route"})))})}return Object.defineProperty(n.prototype,"name",{get:function(){return t(this.$scope.name)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"alias",{get:function(){return t(this.$scope.alias,this.name)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"run",{get:function(){return r(this.$scope.run,"manual",["once","auto"])},enumerable:!0,configurable:!0}),n.$inject=["$scope","$routeParams","$log"],n}();n.Controller=i;n.Directive=u}(e=n.Procedure||(n.Procedure={})),function(n){function u(){return{restrict:"E",scope:{name:"@",type:"@",value:"@",format:"@",required:"@"},controller:i,require:["^^oux","^^ouxProcedure","ouxParameter"],link:{pre:function(n,t,i,r){r[1].addParameter(r[2]);n.$on("$destroy",function(){r[1].removeParameter(r[2])})},post:function(n,t,i,r){r[1].run==="auto"&&n.$watch(function(){return r[0].parameterValue(r[2])},function(n,t){n!==t&&r[0].execute(r[1].alias)})}}}}var i=function(){function n(n){this.$scope=n}return Object.defineProperty(n.prototype,"name",{get:function(){return t(this.$scope.name)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return r(this.$scope.type,"value",["route","scope"])},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return t(this.$scope.value,this.type==="route"?this.name:undefined)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"format",{get:function(){return r(this.$scope.format)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"required",{get:function(){return r(this.$scope.required)==="true"},enumerable:!0,configurable:!0}),n.$inject=["$scope"],n}();n.Controller=i;n.Directive=u}(f=n.Parameter||(n.Parameter={})),function(n){function u(){var n=function(n){return{restrict:"E",templateUrl:"ouxForm.html",transclude:!0,scope:{heading:"@",load:"@",save:"@","delete":"@"},controller:r,controllerAs:"ouxForm",require:["^^oux","ouxForm"],link:{pre:function(t,i,r,u){function f(i){var r=i.split(" as ",2),o=r[0],f=r.length>1?r[1]:r[0];angular.isUndefined(u[0].procedures[f])&&u[0].addProcedure(n.instantiate(e.Controller,{$scope:angular.extend(t.$new(!0),{name:o,alias:f,routeParams:"true"})}))}u[1].loadable&&(f(t.load),u[1].load=function(){u[0].execute(u[1].loadProcAlias)});u[1].editable&&(f(t.save),u[1].save=function(){u[0].execute(u[1].saveProcAlias)});u[1].deletable&&(f(t.delete),u[1].delete=function(){u[0].execute(u[1].deleteProcAlias)})},post:function(n,t,i,r){r[1].load()}}}};return n.$inject=["$injector"],n}var r=function(){function n(n,t){var i=this;this.$scope=n;this.$route=t;this.load=undefined;this.save=undefined;this.delete=undefined;this.undo=function(){i.$route.reload()}}return Object.defineProperty(n.prototype,"loadable",{get:function(){return!i(this.$scope.load)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loadProcName",{get:function(){return this.$scope.load.split(" as ",2)[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loadProcAlias",{get:function(){return this.$scope.load.split(" as ",2)[1]||this.loadProcName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"editable",{get:function(){return!i(this.$scope.save)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"saveProcName",{get:function(){return this.$scope.save.split(" as ",2)[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"saveProcAlias",{get:function(){return this.$scope.save.split(" as ",2)[1]||this.saveProcName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"deletable",{get:function(){return!i(this.$scope.delete)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"deleteProcName",{get:function(){return this.$scope.delete.split(" as ",2)[0]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"deleteProcAlias",{get:function(){return this.$scope.delete.split(" as ",2)[1]||this.deleteProcName},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"heading",{get:function(){return t(this.$scope.heading)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dirty",{get:function(){return this.$scope.form.$dirty},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"invalid",{get:function(){return this.$scope.form.$invalid},enumerable:!0,configurable:!0}),n.$inject=["$scope","$route"],n}();n.Controller=r;n.DirectiveFactory=u}(h=n.Form||(n.Form={})),function(n){function u(){return{restrict:"E",templateUrl:"ouxInput.html",scope:{label:"@",ngModel:"=",format:"@",required:"@",save:"@"},controller:i,controllerAs:"ouxInput",require:["^^ouxForm","ouxInput"],link:{pre:function(n,i,r,u){Object.defineProperty(u[1],"invalid",{get:function(){return u[0].dirty&&n.form.$invalid}});angular.isDefined(r.save)&&Object.defineProperty(u[1],"save",{get:function(){return t(r.save,r.ngModel.split(".").pop())}})}}}}var i=function(){function n(n,t,i){this.$scope=n;this.$locale=t;this.$filter=i;this.isOpen=!1}return Object.defineProperty(n.prototype,"label",{get:function(){return this.$scope.label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"format",{get:function(){return r(this.$scope.format)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"datePickerFormat",{get:function(){if(this.format!=="date")return undefined},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"model",{get:function(){return this.$scope.ngModel},set:function(n){this.$scope.ngModel=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputType",{get:function(){switch(this.format){case"email":return"email";case"url":return"url";default:return"text"}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"required",{get:function(){return angular.isUndefined(this.$scope.required)?!1:r(this.$scope.required,"true")!=="false"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasAddons",{get:function(){switch(this.format){case"date":case"email":case"url":return!0;default:return!1}},enumerable:!0,configurable:!0}),n.$inject=["$scope","$locale","$filter"],n}();n.Controller=i;n.Directive=u}(c=n.Input||(n.Input={})),function(n){function i(){return{restrict:"A",require:["^^oux","^^ouxForm","ngModel"],link:{pre:function(n,i,r,u){var o=u[0].procedures[u[1].saveProcAlias],h=t(r.ouxSave,String(r.ngModel).split(".").pop()),s=angular.extend(n.$new(),{name:h,type:"value",required:String(angular.isDefined(r.required))}),e;Object.defineProperty(s,"value",{get:function(){return u[2].$modelValue}});e=new f.Controller(s);o.addParameter(e);n.$on("$destroy",function(){o.removeParameter(e)})}}}}n.Directive=i}(l=n.Save||(n.Save={})),function(n){function u(){var n=function(n,u){return{restrict:"A",require:"ngModel",link:function(f,e,o,s){var h=r(o.ouxFormat);switch(h){case"date":i(o.placeholder)&&o.$set("placeholder",angular.lowercase(n.dateFormat.moment));s.$parsers.push(function(n){return n});break;case"integer":i(o.placeholder)&&o.$set("placeholder",u("number")(9999,0).replace(new RegExp("9","g"),"#"));s.$formatters.push(function(t){return n.formatNumber(t,0)});s.$parsers.push(function(t){return n.parseNumber(t,0)});break;case"decimal":i(o.placeholder)&&o.$set("placeholder",u("number")(9999.99,2).replace(new RegExp("9","g"),"#"));s.$formatters.push(function(t){return n.formatNumber(t,2)});s.$parsers.push(function(t){return n.parseNumber(t,2)});break;default:switch(h){case"email":i(o.placeholder)&&o.$set("placeholder","somebody@somewhere.com");break;case"url":i(o.placeholder)&&o.$set("placeholder","http://www.somewhere.com")}s.$formatters.push(function(n){return t(n)});s.$parsers.push(function(n){return t(n)})}}}};return n.$inject=["ouxLocale","$filter"],n}n.DirectiveFactory=u}(a=n.Format||(n.Format={}))})(OUX||(OUX={}));oux=angular.module("oux",["ngRoute","ui.bootstrap"]);oux.service("ouxLocale",OUX.Locale.Service);oux.run(["$locale","$log","ouxLocale",function(n,t,i){moment.locale(n.id);t.info({locale:n.id,dateFormat:moment.localeData().longDateFormat("L"),currencySymbol:n.NUMBER_FORMATS.CURRENCY_SYM,decimalSeparator:n.NUMBER_FORMATS.DECIMAL_SEP,groupSeparator:n.NUMBER_FORMATS.GROUP_SEP,ouxLocale:angular.toJson(i.dateFormat)});t.debug(i.formatNumber("-123456789.855"))}]);oux.directive("oux",OUX.Context.DirectiveFactory());oux.directive("ouxProcedure",OUX.Procedure.Directive);oux.directive("ouxParameter",OUX.Parameter.Directive);oux.directive("ouxForm",OUX.Form.DirectiveFactory());oux.directive("ouxInput",OUX.Input.Directive);oux.directive("ouxSave",OUX.Save.Directive);oux.directive("ouxFormat",OUX.Format.DirectiveFactory());
//# sourceMappingURL=oux-core.min.js.map
